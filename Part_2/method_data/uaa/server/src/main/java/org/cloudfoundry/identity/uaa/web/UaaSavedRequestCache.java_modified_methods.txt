Method: shouldSaveFormRedirectParameter
VULNERABLE VERSION:


    protected boolean shouldSaveFormRedirectParameter(HttpServletRequest request) {
        String formRedirect = request.getParameter(FORM_REDIRECT_PARAMETER);
        if (!HttpMethod.POST.name().equals(request.getMethod())) {
            return false;
        }
        if (StringUtils.isEmpty(formRedirect)) {
            return false;
        }

        if (hasSavedRequest(request)) {
            return false;
        }

        return POST.name().equals(request.getMethod());
    }
FIXED VERSION:


    protected boolean shouldSaveFormRedirectParameter(HttpServletRequest request) {
        String formRedirect = request.getParameter(FORM_REDIRECT_PARAMETER);
        if (!HttpMethod.POST.name().equals(request.getMethod())) {
            return false;
        }
        if (StringUtils.isEmpty(formRedirect)) {
            return false;
        }
        if (!UaaUrlUtils.uriHasMatchingHost(formRedirect, request.getServerName())) {
            return false;
        }
        if (hasSavedRequest(request)) {
            return false;
        }

        return POST.name().equals(request.getMethod());
    }
================================================================================
